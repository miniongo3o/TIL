AWS 수행평가.



##### 아래 요건을 만족하는 AWS 서비스 인프라를 구축하고, 인프라 구축 과정을 동영상 캡쳐한 파일과 외부에서 접속 가능한 ELB 퍼블릿 도메인 주소를 제출하시오. 

1. ELB 퍼블릿 도메인 주소로 요청하면 아래와 같은 형식의 출력(응답)을 제공합니다. 
클라우드 OO조 OOO입니다.
현재 접속한 호스트(서버)의 주소는 OOO.OOO.OOO.OOO입니다. 
또는 
현재 접속한 호스트(서버)의 이름은 OOOOOOO입니다. 

2. 웹 서버는 EC2 인스턴스에 구성하며, 실행 환경과 사용 언어는 무관합니다. 

3. 웹 서버는 Auto Scaling Group으로 구성되면 최소 2개, 최대 3개의 인스턴스를 유지합니다. 

4. 서비스는 Elastic Load Balancer를 이용하여 부하분산을 제공합니다.
평가기준
- EC2 인스턴스를 생성하고 서비스에 필요한 실행 환경을 구성하고 코드 배포를 할 수 있다. 
- 사용자 정의 AMI를 생성할 수 있다. 
- 시작 템플릿을 생성할 수 있다. 
- Auto Scaling 설정을 할 수 있다.
- 로드 밸런서를 생성할 수 있다.



```
[ec2-user@ip]$ sudo cat /var/www/aws-exercise-a/app.js
```

```
const express = require('express');
const app = express();

var os = require('os');

app.get('/', (req, res) => {
  res.send(`
        클라우드 3조 이민용입니다. </br>
        현재 접속한 호스트(서버)의 이름은 ${os.hostname()} 입니다.`);
});


app.listen(3000, () => {
  console.log('Example app listening on port 3000!');
});

app.get('/health', (req, res) => {
  res.status(200).send();
});
```

```
sudo service nginx restart
```

보안그룹/페어키/퓨전 패신져, nginx를 설치해놓은 인스턴스의 /var/www/app.js 파일을 수정한다. os를 활용하면, 현재 접속한 서버의 ip를 알 수 있다. 



1. EC2 - 인스턴스에서 해당 인스턴스를 **중지**하고, **우클릭 - 이미지 - 이미지 생성**.

2. **인스턴스 - 시작템플릿 - 생성된 이미지 선택 후 시작 템플릿을 생성**한다.
3. **오토 스케일링 - 오토 스케일링 그룹 - 생성 - 이름 선정 - 시작 템플릿 선택 -** 

**서브넷을 a,c 두개를 추가**한다. (로드밸런싱 할 대상 두개의 서버) - 그룹 크기를 2/2/3으로 선정. 위의 요구사항에서 최대 3개, 평소 2개를 운영한다고 했으므로 - 요구사항에는 없지만, 대상 추적 조정 정책을 선택하여 CPU사용류를 지정하면, 해당 사용률이 넘어갈 경우 새로운 인스턴스를 생성하여 분배해준다. 

4. **로드밸런싱 - 로드밸런서 - 로드밸런서 생성 - http/https 선택 - 가용 영역을 위에서 선택한 a, c 선택 -  보안그룹은 web**만 선택해준다. ssh 접속할 일이 없기 떄문. - 이름을 지정해주고, healt check를 위한 경로도 지정해준다. 대상 등록은 **오토스케일링 설정으로 생겨난 2개의 인스턴스**를 지정해준다.

5. **로드밸런싱 - 대상 그룹에서 오토 스케일링 그룹의 인스턴스가 대상으로 등록된 것**을 확인. 
6. 그렇지 않다면 오토 스케일링 - 오토스케일링 그룹 - 생성한 그룹 선택 - 로드밸런싱 편집 - 대상그룹을 지정해준다. 
7. **로드밸런싱** - **로드밸런서** - **public dns를** 복사하여 브라우저로 접속하면, 새로고침할 때마다 **2개의 인스턴스의 private ip**가 출력된다.

